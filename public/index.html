<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PEER TUTORING JOB BOARD</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <script src="common-auth.js"></script>
    <script src="firebase-config.js"></script>
    <style>
      /* General body styling */
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        margin: 0;
        height: 100vh;
        font-family: "Montserrat", sans-serif;
        background-color: #f4f4f4;
        overflow-x: hidden; /* avoid horizontal scroll on tiny screens */
      }

      /* Title styling */
      h1 {
        font-size: 3rem;
        color: #333;
        margin: 30px 0 20px; /* Pushes the title to the top */
        text-align: center;
      }

      /* Container for the box */
      .box {
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 6px 9px rgba(0, 0, 0, 0.1);
        margin: 40px 16px;
        width: min(
          450px,
          calc(100vw - 32px)
        ); /* account for 16px side margins */
        padding: 28px 20px;
        text-align: center;
        box-sizing: border-box; /* prevent padding from causing overflow */
      }

      /* Button styling */
      .button {
        display: block;
        padding: 18px;
        margin: 16px 0;
        font-size: 1.25rem;
        font-weight: bold;
        color: white !important; /* White text on buttons */
        background-color: #007bff;
        border: none;
        border-radius: 8px;
        text-align: center;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        box-sizing: border-box; /* include padding in width to avoid overflow */
      }

      .button:hover {
        background-color: #0056b3;
      }

      /* Spacing below the buttons */
      .box p {
        margin-top: 16px;
        font-size: 1rem;
        color: #555;
      }

      /* Link styling */
      .box a {
        color: #007bff;
        text-decoration: none;
        font-weight: bold;
      }

      .box a:hover {
        text-decoration: underline;
      }

      /* Larger screens: scale up spacing and text */
      @media (min-width: 700px) {
        .box {
          margin: 100px auto;
          padding: 45px 30px;
          width: 450px;
        }
        .button {
          padding: 22px;
          margin: 24px 0;
          font-size: 1.5rem;
        }
        .box p {
          margin-top: 24px;
          font-size: 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Title at the top of the page -->
    <h1>PEER TUTORING JOB BOARD</h1>

    <!-- Container for the buttons and additional text -->
    <div id="banner" style="display:none;max-width:450px;color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;padding:10px 12px;border-radius:8px;margin-top:12px"></div>
    <div class="box">
      <!-- Buttons -->
      <a href="request.html" class="button">I'm a student!</a>
      <a href="signin.html" class="button">I'm a tutor!</a>
      <a id="adminBtn" href="#" class="button">I'm an admin!</a>
    </div>
    <script>
      // Pre-auth navigation guards: decide before following admin link
      (function(){
        const adminBtn = document.getElementById('adminBtn');
        const banner = document.getElementById('banner');
        adminBtn.addEventListener('click', function(ev){
          ev.preventDefault();
          // Lazy load compat SDK to avoid blocking paint
          const s1 = document.createElement('script'); s1.src = 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js';
          const s2 = document.createElement('script'); s2.src = 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js';
          const s3 = document.createElement('script'); s3.src = 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js';
          let loaded = 0; function go(){ if(++loaded<3) return; proceed(); }
          s1.onload = go; s2.onload = go; s3.onload = go;
          document.head.appendChild(s1); document.head.appendChild(s2); document.head.appendChild(s3);
          function proceed(){
            if (!firebase.apps.length) firebase.initializeApp(window.__FIREBASE_CONFIG__);
            const auth = firebase.auth();
            const db = firebase.firestore();
            auth.onAuthStateChanged(async function(u){
              if(!u){ window.location.href = 'signin.html?next=admin.html'; return; }
              try{
                const d = await db.collection('users').doc(u.uid).get();
                const role = d.exists ? (d.data().role||null) : null;
                if(role === 'Admin' || role === 'Head' || role === 'Developer'){
                  window.location.href = 'admin.html';
                } else {
                  banner.textContent = "You don't have permission to view the admin page.";
                  banner.style.display = 'block';
                }
              }catch(e){ window.location.href='signin.html?next=admin.html'; }
            });
          }
        });
      })();
    </script>
  </body>
</html>
