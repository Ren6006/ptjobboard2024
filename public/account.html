<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Information</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      /* Account info container styling */
      #account-info {
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #fafafa;
        box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      }

      #account-info h1 {
        margin-top: 0;
        text-align: center;
      }

      #account-info p {
        margin: 10px 0;
      }

      #classes-list {
        list-style-type: disc;
        margin: 10px 0 0 20px;
        padding: 0;
      }

      /* "MY ACCOUNT" button styling at top right */
      .my-account-btn {
        position: absolute;
        top: 20px; 
        right: 20px; 
        background-color: #007BFF; 
        color: #FFFFFF; 
        padding: 10px 20px; 
        text-decoration: none;
        border-radius: 4px;
        font-weight: bold;
        font-family: Arial, sans-serif;
      }
      .my-account-btn:hover {
        background-color: #0056b3;
      }

      /* ===== Copied from board.html for requests styling ===== */
      #upcoming-sessions {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin: 50px auto;
        max-width: 800px;
      }

      .post-it {
        width: 200px; /* Adjust as needed */
        background-color: #fdfd96; /* "Post-it" style yellow */
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
        font-family: Arial, sans-serif;
      }

      .post-it h3 {
        margin: 0 0 5px 0;
        font-size: 18px;
        font-weight: bold;
      }

      .post-it p {
        margin: 5px 0;
        font-size: 14px;
      }

      .post-it strong {
        font-weight: bold;
      }
      /* ========================================== */
    </style>
</head>
<body>
    <div id="account-info">
        <h1>Account Information</h1>
        <p id="account-name"><strong>Name:</strong> Loading...</p>
        <p id="account-email"><strong>Email:</strong> Loading...</p>
        <p id="account-phone"><strong>Phone Number:</strong> Loading...</p>
        <p><strong>Available Classes:</strong></p>
        <ul id="classes-list">
            <li>Loading classes...</li>
        </ul>
    </div>

    <!-- “Upcoming Sessions” will now serve as the container for the post-it requests -->
    <div id="upcoming-sessions">
      <!-- Requests will be appended here as .post-it notes -->
    </div>

    <!-- Include Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <!-- Include Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="common-auth.js"></script>
    <script>
      // Your Firebase configuration
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "ptjobboard2024.firebaseapp.com",
        databaseURL: "https://ptjobboard2024-default-rtdb.firebaseio.com",
        projectId: "ptjobboard2024",
        storageBucket: "ptjobboard2024.appspot.com",
        messagingSenderId: "401143229772",
        appId: "1:401143229772:web:b5b14d89a89d75443df3e9",
        measurementId: "G-PF9F78SKZV"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Parse the email from the URL query parameter
      const urlParams = new URLSearchParams(window.location.search);
      const email = urlParams.get('email');

      // References to DOM elements
      const nameElem = document.getElementById('account-name');
      const emailElem = document.getElementById('account-email');
      const phoneElem = document.getElementById('account-phone');
      const classesListElem = document.getElementById('classes-list');
      const upcomingSessionsDiv = document.getElementById('upcoming-sessions');

      // If no email is provided, indicate so
      if (!email) {
        nameElem.innerHTML = "<strong>Name:</strong> N/A";
        emailElem.innerHTML = "<strong>Email:</strong> No email provided.";
        phoneElem.innerHTML = "<strong>Phone Number:</strong> N/A";
        classesListElem.innerHTML = "<li>No classes available</li>";
      } else {
        // Query the Accounts collection for this user
        db.collection("Accounts")
          .where("Email", "==", email)
          .limit(1)
          .get()
          .then((querySnapshot) => {
            if (querySnapshot.empty) {
              // No account found
              nameElem.innerHTML = "<strong>Name:</strong> Account not found";
              emailElem.innerHTML = `<strong>Email:</strong> ${email}`;
              phoneElem.innerHTML = "<strong>Phone Number:</strong> N/A";
              classesListElem.innerHTML = "<li>No classes found</li>";
            } else {
              querySnapshot.forEach((doc) => {
                const data = doc.data();
                const name = data.Name || "N/A";
                const phone = data["Phone Number"] || "N/A";
                const classes = data["Available Classes"] || [];

                nameElem.innerHTML = `<strong>Name:</strong> ${name}`;
                emailElem.innerHTML = `<strong>Email:</strong> ${data.Email || email}`;
                phoneElem.innerHTML = `<strong>Phone Number:</strong> ${phone}`;

                if (classes.length > 0) {
                  classesListElem.innerHTML = ""; 
                  classes.forEach((classItem) => {
                    const li = document.createElement('li');
                    li.textContent = classItem;
                    classesListElem.appendChild(li);
                  });
                } else {
                  classesListElem.innerHTML = "<li>No classes available</li>";
                }
              });
            }
          })
          .catch((error) => {
            console.error("Error getting account document:", error);
            nameElem.innerHTML = "<strong>Name:</strong> Error loading account";
            emailElem.innerHTML = `<strong>Email:</strong> ${email}`;
            phoneElem.innerHTML = "<strong>Phone Number:</strong> Error";
            classesListElem.innerHTML = "<li>Error loading classes</li>";
          });
      }

      // ===== Fetch and display Requests just like in board.html =====
      // This shows *all* requests. If you only want requests *for this user*, 
      // use .where("email","==", email) or something similar in your query.
      db.collection("Sessions")
        .where("tutor email", "==", email)
        .get()
        .then((querySnapshot) => {
          querySnapshot.forEach((doc) => {
            const data = doc.data();

            // Create a post-it note element
            const note = document.createElement('div');
            note.classList.add('post-it');

            // Construct the inner HTML with document data
            note.innerHTML = `
              <h3>${data.name || "No Name"}</h3>
              <p><strong>Email:</strong> ${data.email || "N/A"}</p>
              <p><strong>Grade:</strong> ${data.grade || "N/A"}</p>
              <p><strong>Subject:</strong> ${data.subject || "N/A"}</p>
              <p><strong>Class:</strong> ${data.class || "N/A"}</p>
              <p><strong>Topic:</strong> ${data.topic || "N/A"}</p>
              <p><strong>Date:</strong> ${data.date || "N/A"}</p>
              <p><strong>Block:</strong> ${data.block || "N/A"}</p>
              <p><strong>Location:</strong> ${data.location || "N/A"}</p>
              <p><strong>Info:</strong> ${data.info || "N/A"}</p>
            `;

            // Append the note to the “Upcoming Sessions” container
            upcomingSessionsDiv.appendChild(note);
          });
        })
        .catch((error) => {
          console.error("Error getting documents: ", error);
        });
    </script>
    <script>
      // Replace document.write navigation with top-right common controls; no extra buttons here
    </script>
</body>
</html>
